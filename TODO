Cleanup primitive.c with some macros/inline functions for argument checking.
